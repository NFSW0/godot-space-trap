shader_type canvas_item;

uniform vec2 line_start;  // 直线的起点（世界坐标）
uniform vec2 line_end;    // 直线的终点（世界坐标）
uniform vec4 color_near : source_color;  // 离直线近的颜色
uniform vec4 color_far : source_color;   // 离直线远的颜色

// 计算点到直线的最短距离
float point_line_distance(vec2 p, vec2 _line_start, vec2 _line_end) {
    // 计算直线方向
    vec2 line_dir = _line_end - _line_start;
    vec2 point_dir = p - _line_start;

    // 计算投影系数
    float t = dot(point_dir, line_dir) / dot(line_dir, line_dir);

    // 计算投影点
    vec2 proj_point = _line_start + t * line_dir;

    // 计算点到投影点的距离
    return length(p - proj_point);
}

void vertex() {
    // 获取当前顶点的世界坐标
    vec2 world_position = (MODEL_MATRIX * vec4(VERTEX, 0.0, 1.0)).xy;

    // 计算顶点到直线的距离
    float dist = point_line_distance(world_position, line_start, line_end);

    // 归一化距离，假设最大距离为1.0（这个值可以根据实际情况调整）
    float max_distance = 1000.0; // 最大距离，可以根据实际需要调整
    float normalized_dist = clamp(dist / max_distance, 0.0, 1.0);

    // 使用渐变色根据距离来插值颜色
    COLOR = mix(color_far, color_near, normalized_dist);
}

void fragment() {
    COLOR = COLOR;  // 直接传递顶点着色器中的颜色
}
